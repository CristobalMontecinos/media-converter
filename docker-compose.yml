services:
  deps-install:
    image: node:22
    env_file: .env
    volumes:
      - ./src_node:/app
    working_dir: '/app'
    command: 'npm install'

  media-convert-node:
    build: .
    env_file: .env
    restart: always
    ports:
      - 8099:3001
    volumes:
      - ./src_node:/app
    working_dir: '/app'
    command: 'node index.js'
    depends_on:
      deps-install:
        condition: service_completed_successfully
        
  # webm-to-mpx-go:
    #  build: .
    #  env_file: .env
    #  restart: on-failure
    #  ports:
    #    - 3001:3001
    #  volumes:
    #    - ./src_go:/app
    #  working_dir: '/app'
    #  command: "go run main.go"
